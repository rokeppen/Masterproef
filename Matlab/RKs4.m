% viertraps EFRK-methode gefit op z1=zfun(h,y) en z2=alpha*z1
%   @param xspan: het interval waarover geïntegreerd wordt
%   @param h: de te gebruiken stapgrootte
%   @param alpha: de verhouding z2/z1
%   @param y0: de beginvoorwaarde
%   @param f: het probleemstelsel
%   @param zfun: de updatefunctie voor z1
function y = RKs4(xspan,h,alpha,y0,f,zfun)
opt = optimoptions('fsolve','Display','Off','MaxIter',5000,'MaxFunEvals',5000000,'FunctionTolerance',1e-16,'OptimalityTolerance',1e-16,'StepTolerance',1e-16);
xn = xspan(1);
y = y0.';
sol = ones(1,5*length(y0))*0.1;
z = zfun(y0,h);
z2 = alpha*z;
th = NRtheta4(z,z2);
[A,b,c] = calculate(z,z2,th(1),th(2));
while xn < xspan(2)-h/2
    xn = xn+h;
    sol = fsolve(@(Y) RKs4_system(Y,A,b,c,h,f,y(:,end),xn),sol,opt);
    y = [y,sol(5:5:length(y0)*5).'];
end
end

% impliciet stelsel ter bepaling van de volgende waarde van y
function F = RKs4_system(Y,A,b,c,h,f,yn,xn)
Y1 = [xn-h+c(1)*h,Y(1:5:length(Y))];
Y2 = [xn-h+c(2)*h,Y(2:5:length(Y))];
Y3 = [xn-h+c(3)*h,Y(3:5:length(Y))];
Y4 = [xn-h+c(4)*h,Y(4:5:length(Y))];
fy = [f(Y1); f(Y2); f(Y3); f(Y4)];
F = zeros(1,length(Y));
for i=1:5:length(Y)
    j = (i-1)/5+1;
    F(i) = yn(j)+h*(A(1,1)*fy(1,j)+A(1,2)*fy(2,j)+A(1,3)*fy(3,j)+A(1,4)*fy(4,j))-Y(i);
    F(i+1) = yn(j)+h*(A(2,1)*fy(1,j)+A(2,2)*fy(2,j)+A(2,3)*fy(3,j)+A(2,4)*fy(4,j))-Y(i+1);
    F(i+2) = yn(j)+h*(A(3,1)*fy(1,j)+A(3,2)*fy(2,j)+A(3,3)*fy(3,j)+A(3,4)*fy(4,j))-Y(i+2);
    F(i+3) = yn(j)+h*(A(4,1)*fy(1,j)+A(4,2)*fy(2,j)+A(4,3)*fy(3,j)+A(4,4)*fy(4,j))-Y(i+3);
    F(i+4) = yn(j)+h*(b(1)*fy(1,j)+b(2)*fy(2,j)+b(3)*fy(3,j)+b(4)*fy(4,j))-Y(i+4);
end
end

% berekening van de coëfficiënten, voor efficiëntiedoeleinden
function [A,b,c] = calculate(z,z2,theta1,theta2)
c = [1/2-theta1, 1/2-theta2, 1/2+theta2, 1/2+theta1];
b1 = (cosh(z2*theta2)*z2*sinh(z/2)-z*cosh(z*theta2)*sinh(z2/2))/((cosh(z2*theta2)*cosh(z*theta1)-cosh(z2*theta1)*cosh(z*theta2))*z2*z);
b2 = (z*sinh(z2/2)*cosh(z*theta1)-z2*cosh(z2*theta1)*sinh(z/2))/(z*(cosh(z2*theta2)*cosh(z*theta1)-cosh(z2*theta1)*cosh(z*theta2))*z2);
b = [b1,b2,b2,b1];
d = 2*z2*z*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1));
a11 = (-z*sinh(z*theta2)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) + z*cosh(z*theta2)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) + sinh(z2*theta2)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) - cosh(z2*theta2)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + ((2*z2*cosh(z*theta1)^2 - z2)*sinh(z2*theta2) - sinh(z*theta2)*(z*cosh(z2*theta1)*cosh(z*theta1) + sinh(z*theta1)*sinh(z2*theta1)*z2))*cosh(z2*theta2) - ((z*sinh(z*theta1)*sinh(z2*theta1) + z2*cosh(z*theta1)*cosh(z2*theta1))*sinh(z2*theta2) - 2*z*(cosh(z2*theta1)^2 - 1/2)*sinh(z*theta2))*cosh(z*theta2))/d;
a12 = (z*sinh(z*theta1)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) - z*cosh(z*theta1)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) - sinh(z2*theta1)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) + cosh(z2*theta1)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) - z*(sinh(z*theta1)*cosh(z*theta2) + cosh(z*theta1)*sinh(z*theta2))*cosh(z2*theta1)^2 + (-sinh(z2*theta2)*z2*cosh(z*theta1)^2 + (z*sinh(z*theta1)*cosh(z2*theta2) + cosh(z*theta2)*sinh(z2*theta1)*z2)*cosh(z*theta1) + z2*(sinh(z*theta1)*sinh(z*theta2)*sinh(z2*theta1) + sinh(z2*theta2)))*cosh(z2*theta1) + (-cosh(z2*theta2)*sinh(z2*theta1)*z2*cosh(z*theta1) + z*(sinh(z*theta1)*sinh(z2*theta1)*sinh(z2*theta2) + sinh(z*theta2)))*cosh(z*theta1))/d;
a13 = (-z*sinh(z*theta1)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) - z*cosh(z*theta1)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) + sinh(z2*theta1)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) + cosh(z2*theta1)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + z*(sinh(z*theta1)*cosh(z*theta2) - cosh(z*theta1)*sinh(z*theta2))*cosh(z2*theta1)^2 + (-sinh(z2*theta2)*z2*cosh(z*theta1)^2 + (-z*sinh(z*theta1)*cosh(z2*theta2) - cosh(z*theta2)*sinh(z2*theta1)*z2)*cosh(z*theta1) + z2*(sinh(z*theta1)*sinh(z*theta2)*sinh(z2*theta1) + sinh(z2*theta2)))*cosh(z2*theta1) + (cosh(z2*theta2)*sinh(z2*theta1)*z2*cosh(z*theta1) + z*(sinh(z*theta1)*sinh(z2*theta1)*sinh(z2*theta2) + sinh(z*theta2)))*cosh(z*theta1))/d;
a14 = (z*sinh(z*theta2)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) + z*cosh(z*theta2)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) - sinh(z2*theta2)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) - cosh(z2*theta2)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + (-sinh(z2*theta2)*z2 + sinh(z*theta2)*(z*cosh(z2*theta1)*cosh(z*theta1) - sinh(z*theta1)*sinh(z2*theta1)*z2))*cosh(z2*theta2) - ((z*sinh(z*theta1)*sinh(z2*theta1) - z2*cosh(z*theta1)*cosh(z2*theta1))*sinh(z2*theta2) + z*sinh(z*theta2))*cosh(z*theta2))/d;
a21 = (-z*sinh(z*theta2)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) + z*cosh(z*theta2)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) + sinh(z2*theta2)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) - cosh(z2*theta2)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) - z*(sinh(z*theta1)*cosh(z*theta2) + cosh(z*theta1)*sinh(z*theta2))*cosh(z2*theta2)^2 + (-sinh(z2*theta1)*z2*cosh(z*theta2)^2 + (z*sinh(z*theta2)*cosh(z2*theta1) + sinh(z2*theta2)*z2*cosh(z*theta1))*cosh(z*theta2) + z2*(sinh(z*theta1)*sinh(z*theta2)*sinh(z2*theta2) + sinh(z2*theta1)))*cosh(z2*theta2) + (-cosh(z*theta2)*cosh(z2*theta1)*sinh(z2*theta2)*z2 + z*(sinh(z*theta2)*sinh(z2*theta1)*sinh(z2*theta2) + sinh(z*theta1)))*cosh(z*theta2))/d;
a22 = (z*sinh(z*theta1)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) - z*cosh(z*theta1)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) - sinh(z2*theta1)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) + cosh(z2*theta1)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + ((2*cosh(z*theta2)^2*z2 - z2)*sinh(z2*theta1) - sinh(z*theta1)*(z*cosh(z*theta2)*cosh(z2*theta2) + sinh(z*theta2)*sinh(z2*theta2)*z2))*cosh(z2*theta1) + 2*((-z*sinh(z*theta2)*sinh(z2*theta2)/2 - cosh(z*theta2)*cosh(z2*theta2)*z2/2)*sinh(z2*theta1) + z*sinh(z*theta1)*(cosh(z2*theta2)^2 - 1/2))*cosh(z*theta1))/d;
a23 = (-z*sinh(z*theta1)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) - z*cosh(z*theta1)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) + sinh(z2*theta1)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) + cosh(z2*theta1)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + (-sinh(z2*theta1)*z2 + sinh(z*theta1)*(z*cosh(z*theta2)*cosh(z2*theta2) - sinh(z*theta2)*sinh(z2*theta2)*z2))*cosh(z2*theta1) - ((z*sinh(z*theta2)*sinh(z2*theta2) - cosh(z*theta2)*cosh(z2*theta2)*z2)*sinh(z2*theta1) + z*sinh(z*theta1))*cosh(z*theta1))/d;
a24 = (z*sinh(z*theta2)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) + z*cosh(z*theta2)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) - sinh(z2*theta2)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) - cosh(z2*theta2)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) - z*(sinh(z*theta1)*cosh(z*theta2) - cosh(z*theta1)*sinh(z*theta2))*cosh(z2*theta2)^2 + (-sinh(z2*theta1)*z2*cosh(z*theta2)^2 + (-z*sinh(z*theta2)*cosh(z2*theta1) - sinh(z2*theta2)*z2*cosh(z*theta1))*cosh(z*theta2) + z2*(sinh(z*theta1)*sinh(z*theta2)*sinh(z2*theta2) + sinh(z2*theta1)))*cosh(z2*theta2) + cosh(z*theta2)*(cosh(z*theta2)*cosh(z2*theta1)*sinh(z2*theta2)*z2 + z*(sinh(z*theta2)*sinh(z2*theta1)*sinh(z2*theta2) + sinh(z*theta1))))/d;
a31 = (-z*sinh(z*theta2)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) + z*cosh(z*theta2)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) + sinh(z2*theta2)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) - cosh(z2*theta2)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + z*(sinh(z*theta1)*cosh(z*theta2) - cosh(z*theta1)*sinh(z*theta2))*cosh(z2*theta2)^2 + (sinh(z2*theta1)*z2*cosh(z*theta2)^2 + (z*sinh(z*theta2)*cosh(z2*theta1) + sinh(z2*theta2)*z2*cosh(z*theta1))*cosh(z*theta2) - z2*(sinh(z*theta1)*sinh(z*theta2)*sinh(z2*theta2) + sinh(z2*theta1)))*cosh(z2*theta2) - cosh(z*theta2)*(cosh(z*theta2)*cosh(z2*theta1)*sinh(z2*theta2)*z2 + z*(sinh(z*theta2)*sinh(z2*theta1)*sinh(z2*theta2) + sinh(z*theta1))))/d;
a32 = (z*sinh(z*theta1)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) - z*cosh(z*theta1)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) - sinh(z2*theta1)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) + cosh(z2*theta1)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + (sinh(z2*theta1)*z2 - sinh(z*theta1)*(z*cosh(z*theta2)*cosh(z2*theta2) - sinh(z*theta2)*sinh(z2*theta2)*z2))*cosh(z2*theta1) + ((z*sinh(z*theta2)*sinh(z2*theta2) - cosh(z*theta2)*cosh(z2*theta2)*z2)*sinh(z2*theta1) + z*sinh(z*theta1))*cosh(z*theta1))/d;
a33 = (-z*sinh(z*theta1)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) - z*cosh(z*theta1)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) + sinh(z2*theta1)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) + cosh(z2*theta1)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + ((-2*cosh(z*theta2)^2*z2 + z2)*sinh(z2*theta1) + sinh(z*theta1)*(z*cosh(z*theta2)*cosh(z2*theta2) + sinh(z*theta2)*sinh(z2*theta2)*z2))*cosh(z2*theta1) - 2*((-z*sinh(z*theta2)*sinh(z2*theta2)/2 - cosh(z*theta2)*cosh(z2*theta2)*z2/2)*sinh(z2*theta1) + z*sinh(z*theta1)*(cosh(z2*theta2)^2 - 1/2))*cosh(z*theta1))/d;
a34 = (z*sinh(z*theta2)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) + z*cosh(z*theta2)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) - sinh(z2*theta2)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) - cosh(z2*theta2)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + z*(sinh(z*theta1)*cosh(z*theta2) + cosh(z*theta1)*sinh(z*theta2))*cosh(z2*theta2)^2 + (sinh(z2*theta1)*z2*cosh(z*theta2)^2 + (-z*sinh(z*theta2)*cosh(z2*theta1) - sinh(z2*theta2)*z2*cosh(z*theta1))*cosh(z*theta2) - z2*(sinh(z*theta1)*sinh(z*theta2)*sinh(z2*theta2) + sinh(z2*theta1)))*cosh(z2*theta2) - (-cosh(z*theta2)*cosh(z2*theta1)*sinh(z2*theta2)*z2 + z*(sinh(z*theta2)*sinh(z2*theta1)*sinh(z2*theta2) + sinh(z*theta1)))*cosh(z*theta2))/d;
a41 = (-z*sinh(z*theta2)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) + z*cosh(z*theta2)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) + sinh(z2*theta2)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) - cosh(z2*theta2)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + (sinh(z2*theta2)*z2 - sinh(z*theta2)*(z*cosh(z2*theta1)*cosh(z*theta1) - sinh(z*theta1)*sinh(z2*theta1)*z2))*cosh(z2*theta2) + ((z*sinh(z*theta1)*sinh(z2*theta1) - z2*cosh(z*theta1)*cosh(z2*theta1))*sinh(z2*theta2) + z*sinh(z*theta2))*cosh(z*theta2))/d;
a42 = (z*sinh(z*theta1)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) - z*cosh(z*theta1)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) - sinh(z2*theta1)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) + cosh(z2*theta1)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) - z*(sinh(z*theta1)*cosh(z*theta2) - cosh(z*theta1)*sinh(z*theta2))*cosh(z2*theta1)^2 + (sinh(z2*theta2)*z2*cosh(z*theta1)^2 + (z*sinh(z*theta1)*cosh(z2*theta2) + cosh(z*theta2)*sinh(z2*theta1)*z2)*cosh(z*theta1) - z2*(sinh(z*theta1)*sinh(z*theta2)*sinh(z2*theta1) + sinh(z2*theta2)))*cosh(z2*theta1) - (cosh(z2*theta2)*sinh(z2*theta1)*z2*cosh(z*theta1) + z*(sinh(z*theta1)*sinh(z2*theta1)*sinh(z2*theta2) + sinh(z*theta2)))*cosh(z*theta1))/d;
a43 = (-z*sinh(z*theta1)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) - z*cosh(z*theta1)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) + sinh(z2*theta1)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) + cosh(z2*theta1)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + z*(sinh(z*theta1)*cosh(z*theta2) + cosh(z*theta1)*sinh(z*theta2))*cosh(z2*theta1)^2 + (sinh(z2*theta2)*z2*cosh(z*theta1)^2 + (-z*sinh(z*theta1)*cosh(z2*theta2) - cosh(z*theta2)*sinh(z2*theta1)*z2)*cosh(z*theta1) - z2*(sinh(z*theta1)*sinh(z*theta2)*sinh(z2*theta1) + sinh(z2*theta2)))*cosh(z2*theta1) - (-cosh(z2*theta2)*sinh(z2*theta1)*z2*cosh(z*theta1) + z*(sinh(z*theta1)*sinh(z2*theta1)*sinh(z2*theta2) + sinh(z*theta2)))*cosh(z*theta1))/d;
a44 = (z*sinh(z*theta2)*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z2/2) + z*cosh(z*theta2)*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z2/2) - sinh(z2*theta2)*z2*(cosh(z2*theta1)*cosh(z*theta2) - cosh(z2*theta2)*cosh(z*theta1))*cosh(z/2) - cosh(z2*theta2)*z2*(sinh(z2*theta2)*sinh(z*theta1) - sinh(z*theta2)*sinh(z2*theta1))*sinh(z/2) + ((-2*z2*cosh(z*theta1)^2 + z2)*sinh(z2*theta2) + sinh(z*theta2)*(z*cosh(z2*theta1)*cosh(z*theta1) + sinh(z*theta1)*sinh(z2*theta1)*z2))*cosh(z2*theta2) + ((z*sinh(z*theta1)*sinh(z2*theta1) + z2*cosh(z*theta1)*cosh(z2*theta1))*sinh(z2*theta2) - 2*z*(cosh(z2*theta1)^2 - 1/2)*sinh(z*theta2))*cosh(z*theta2))/d;
A = [a11,a12,a13,a14;a21,a22,a23,a24;a31,a32,a33,a34;a41,a42,a43,a44];
end